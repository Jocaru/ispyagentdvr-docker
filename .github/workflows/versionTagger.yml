name: Check for updates and tag
on: 
  #Manual dispatch trigger
  repository_dispatch:
    types: execute
  #Run 3 times per day, evenly distributed
  schedule:
    - cron : '* */8 * * *'

jobs:
  build:
    # Job name is Greeting
    name: Update iSpy Agent DVR
    # This job runs on Linux
    runs-on: ubuntu-latest
    steps:
      - name: Get file name
        run: echo ::set-env name=FILE_NAME::$(echo $(wget -qO- "https://www.ispyconnect.com/api/Agent/DownloadLocation2?productID=24&is64=true&platform=Linux" | tr -d '"'))
      
      - name: Print FILE_NAME
        run: echo ${{env.FILE_NAME}}

      - name: Get version number
        run: echo ::set-env name=VERSION::$(echo $FILE_NAME | grep -Po "(?<=Linux64_).*(?=.zip)" | tr _ .)
      
      - name: Print VERSION
        run: echo ${{env.VERSION}}